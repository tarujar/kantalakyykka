{% macro render_throw_input(throw_field) %}
    <td><input type="text" name="{{ throw_field.name }}" value="{{ throw_field.data if throw_field.data is not none else '' }}" class="form-control" required></td>
{% endmacro %}

{% macro render_score_input(form, team_num, round_num) %}
    {% set score_attr = 'score_' ~ team_num ~ '_' ~ round_num %}
    {% set score_field = form[score_attr] %}
    <input type="number" 
           name="{{ score_field.name }}" 
           value="{{ score_field.data if score_field.data is not none else '' }}" 
           class="form-control score-input">
{% endmacro %}
<!--
Score sheet order for 4-player-team game-throws is always the same:
Round 1:
Team 1: Player 1
Team 1: Player 2
Team 2: Player 1
Team 2: Player 2
Team 1: Player 3
Team 1: Player 4
Team 2: Player 3
Team 2: Player 4

Round 2:
Team 2: Player 1
Team 2: Player 2
Team 1: Player 1
Team 1: Player 2
Team 2: Player 3
Team 2: Player 4
Team 1: Player 3
Team 1: Player 4
-->
<div class="desktop-form">
    <div class="table-responsive">
        <table class="game-score-sheet-table table table-bordered">
            <thead>
                <tr>
                    <th>{{ _('Team') }}</th>
                    <th>{{ _('Player') }}</th>
                    <th>{{ _('Throw 1') }}</th>
                    <th>{{ _('Throw 2') }}</th>
                    <th>{{ _('Throw 3') }}</th>
                    <th>{{ _('Throw 4') }}</th>
                </tr>
            </thead>
            <tbody>
                <!-- Round 1 -->
                {% for round_num in [1, 2] %}
                    <tr class="round-header">
                        <td colspan="6">{{ _('Round') }} {{ round_num }}</td>
                    </tr>

                    {# Define which team goes first based on round number #}
                    {% set first_team = form.team_1_round_throws if round_num == 1 else form.team_2_round_throws %}
                    {% set second_team = form.team_2_round_throws if round_num == 1 else form.team_1_round_throws %}
                    {% set first_team_num = '1' if round_num == 1 else '2' %}
                    {% set second_team_num = '2' if round_num == 1 else '1' %}

                    {# First two players from first team #}
                    {% for player_index in [0, 1] %}
                        {% set throw_form = first_team.entries[0] %}
                        {% set single_throw = throw_form['round_' ~ round_num].entries[player_index] %}
                        <tr class="single-throw-form">
                            <td>{{ _(first_team_num ~ '. ') }}</td>
                            <td>
                                <select name="{{ single_throw.player_id.name }}" class="form-control" required>
                                    {% for value, label in single_throw.player_id.choices %}
                                        <option value="{{ value }}" {% if value == single_throw.player_id.data %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            {% for i in range(1, 5) %}
                                {{ render_throw_input(single_throw['throw_' ~ i]) }}
                            {% endfor %}
                            <input type="hidden" name="{{ single_throw.game_set_index.name }}" value="{{ round_num }}">
                            <input type="hidden" name="{{ single_throw.throw_position.name }}" value="{{ player_index + 1 }}">
                            <input type="hidden" name="{{ single_throw.home_team.name }}" value="{{ 'true' if first_team_num == '1' else 'false' }}">
                        </tr>
                    {% endfor %}

                    {# First two players from second team #}
                    {% for player_index in [0, 1] %}
                        {% set throw_form = second_team.entries[0] %}
                        {% set single_throw = throw_form['round_' ~ round_num].entries[player_index] %}
                        <tr class="single-throw-form">
                            <td>{{ _(second_team_num ~ '. ') }}</td>
                            <td>
                                <select name="{{ single_throw.player_id.name }}" class="form-control" required>
                                    {% for value, label in single_throw.player_id.choices %}
                                        <option value="{{ value }}" {% if value == single_throw.player_id.data %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            {% for i in range(1, 5) %}
                                {{ render_throw_input(single_throw['throw_' ~ i]) }}
                            {% endfor %}
                            <input type="hidden" name="{{ single_throw.game_set_index.name }}" value="{{ round_num }}">
                            <input type="hidden" name="{{ single_throw.throw_position.name }}" value="{{ player_index + 1 }}">
                            <input type="hidden" name="{{ single_throw.home_team.name }}" value="{{ 'true' if second_team_num == '1' else 'false' }}">
                        </tr>
                    {% endfor %}

                    {# Last two players from first team #}
                    {% for player_index in [2, 3] %}
                        {% set throw_form = first_team.entries[0] %}
                        {% set single_throw = throw_form['round_' ~ round_num].entries[player_index] %}
                        <tr class="single-throw-form">
                            <td>{{ _(first_team_num ~ '. ') }}</td>
                            <td>
                                <select name="{{ single_throw.player_id.name }}" class="form-control" required>
                                    {% for value, label in single_throw.player_id.choices %}
                                        <option value="{{ value }}" {% if value == single_throw.player_id.data %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            {% for i in range(1, 5) %}
                                {{ render_throw_input(single_throw['throw_' ~ i]) }}
                            {% endfor %}
                            <input type="hidden" name="{{ single_throw.game_set_index.name }}" value="{{ round_num }}">
                            <input type="hidden" name="{{ single_throw.throw_position.name }}" value="{{ player_index + 1 }}">
                            <input type="hidden" name="{{ single_throw.home_team.name }}" value="{{ 'true' if first_team_num == '1' else 'false' }}">
                        </tr>
                    {% endfor %}

                    {# Last two players from second team #}
                    {% for player_index in [2, 3] %}
                        {% set throw_form = second_team.entries[0] %}
                        {% set single_throw = throw_form['round_' ~ round_num].entries[player_index] %}
                        <tr class="single-throw-form">
                            <td>{{ _(second_team_num ~ '. ') }}</td>
                            <td>
                                <select name="{{ single_throw.player_id.name }}" class="form-control" required>
                                    {% for value, label in single_throw.player_id.choices %}
                                        <option value="{{ value }}" {% if value == single_throw.player_id.data %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            {% for i in range(1, 5) %}
                                {{ render_throw_input(single_throw['throw_' ~ i]) }}
                            {% endfor %}
                            <input type="hidden" name="{{ single_throw.game_set_index.name }}" value="{{ round_num }}">
                            <input type="hidden" name="{{ single_throw.throw_position.name }}" value="{{ player_index + 1 }}">
                            <input type="hidden" name="{{ single_throw.home_team.name }}" value="{{ 'true' if second_team_num == '1' else 'false' }}">
                        </tr>
                    {% endfor %}

                    <!-- Display round scores -->
                    <tr class="round-score">
                        <td colspan="2">{{ _('Round') }} {{ round_num }} {{ _('Scores') }}</td>
                        <td colspan="2">
                            {{ render_score_input(form, '1', round_num) }}
                        </td>
                        <td colspan="2">
                            {{ render_score_input(form, '2', round_num) }}
                        </td>
                    </tr>
                {% endfor %}

                <!-- Display end scores -->
                <tr class="end-score">
                    <td colspan="2">{{ _('End Scores') }}</td>
                    <td colspan="2">{{ form.end_score_team_1.data if form.end_score_team_1.data is not none else 0 }}</td>
                    <td colspan="2">{{ form.end_score_team_2.data if form.end_score_team_2.data is not none else 0 }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<style>
    .desktop-form {
        margin: 0 auto;
        max-width: 1200px;
    }

    .form-control {
        width: 100%;
        padding: 6px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }
    
    .single-throw-form input[type="text"] {
        width: 60px;
    }
    
    .round-score input[type="number"] {
        width: 80px;
    }

    .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .game-score-sheet-table {
        background-color: white;
    }

    .round-header {
        background-color: #f8f9fa;
    }

    .round-score, .end-score {
        background-color: #e9ecef;
    }
</style>
